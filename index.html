<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
</head>
<script src="./bundle.js"></script>
<style>
	.vertical-center {
	  min-height: 100%;  /* Fallback for browsers do NOT support vh unit */
	  min-height: 100vh; /* These two lines are counted as one :-)       */

	  display: flex;
	  align-items: center; 
	}
	.jumbotron{ 
	  height:100%;
	  width:100%;
	}
	.item_text{
	  font-family:'微軟正黑體';
	}
	.title{
		margin-bottom: 20px;
	}
	.img-thumbnail{
		width:36px;
		height:36px;
	}
	.wrap-contact{
		background: #b3d7ff;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
		padding-top: 55px;
		padding-bottom: 55px;
		border-radius: 10px;
		padding: 55px 55px 55px 55px;
	}
</style>
<body>
	<div class="jumbotron vertical-center bg-light">
		<div class="container wrap-contact" style="width: 500px;">
			<div class="row justify-content-center align-items-center">
				<div class="item_text">  
					<div class="row">
						<div class="col">
							<h2 id="title" class="text-center text-black font-weight-bold title">待辦清單</h2>
						</div>
					</div>
					<div class="row mb-4">
						<div class="col">
							<input type="textbox" class="form-control" id="item" name="item" />
						</div>
						<input type="button" id="add" class="btn btn-success" value="Go" onClick="add_item()">
					</div>
					<div class="card bg-light text-secondary shadow p-4 mb-4 bg-white">
						<div class="card-body">
							<div id="item_list">
								<table id="item_table" class="table">
									<tr class="table-info">
										<th scope="col"></th>
										<th scope="col">項目</th>
										<th scope="col">修改</th>
										<th scope="col">刪除</th>
									</tr>
									<tr id="item0">
										<td scope="row"><input type="checkbox" id="success" name="success" ></td>
										<td class="text">7點~8點晨跑</td>
										<td><img src="./assets/images/pencil.png" alt=""  class="img-thumbnail" id="pencil" /></td>
										<td><img src="./assets/images/delete.png" alt=""  class="img-thumbnail" id="delete" /></td>
									</tr>
									<tr id="item1">
										<td scope="row"><input type="checkbox" id="success" name="success" /></td>
										<td class="text">8點~9點準備上班</td>
										<td><img src="./assets/images/pencil.png" alt=""  class="img-thumbnail" id="pencil" /></td>
										<td><img src="./assets/images/delete.png" alt=""  class="img-thumbnail" id="delete" /></td>
									</tr>
								</table>
							</div>
						</div>
					</div>
					<div class="card bg-light text-secondary shadow p-4 mb-4 bg-white">
						<div class="card-body">
							<h2 id="title" class="text-center text-black font-weight-bold">已完成</h2>
							<div id="success_list">
								<table id="success_table" class="table">
									<tr class="table-info">
										<th scope="col"></th>
										<th scope="col">項目</th>
										<th scope="col">修改</th>
										<th scope="col">刪除</th>
									</tr>
									<tr id="su_item0">
										<td><input type="checkbox" id="success" name="success" checked/></td>
										<td class="text" style="text-decoration:line-through">5點~6點準備起床盥洗</td>
										<td><img src="./assets/images/pencil.png" alt=""  class="img-thumbnail" id="pencil" /></td>
										<td><img src="./assets/images/delete.png" alt=""  class="img-thumbnail" id="delete" /></td>
									</tr>
								</table>
							<div>
						<div>
					<div>
				<div>
			<div>
		<div>
	<div>
</body>
<script language="JavaScript">
window.onload=getTableData;
function getTableData(){
	let days = 30;
	let date = new Date();
	date.setTime(date.getTime()+(days*24*60*60*1000));
	document.cookie = "SetCookie" + "=" + escape("132456") + ";expires=" + date.toGMTString();
	
	console.log(document.cookie);
	//alert(getCookie("item_table"));
}

let img = document.getElementsByClassName("img-thumbnail");
for(var i=0; i<img.length; i++){
	if(img[i].id == 'delete'){
		img[i].addEventListener('click',deleteItem);
	}else{
		img[i].addEventListener('click',updateItem);
	}
}

let input = document.getElementsByTagName("input");
for(var i=0; i<input.length; i++){
	if(input[i].type == 'checkbox'){
		input[i].addEventListener('click',successItem);
	}
}

function add_item(){
	let item_table = document.getElementById("item_table");
	let item = document.getElementById("item").value;
	let length = item_table.rows.length;
	let item_id = "item"+(length-1);
	
	let tr = item_table.insertRow(length);
	tr.setAttribute("id", item_id);
	
	let input = document.createElement("input");
	let img = document.createElement("img");
	
	//用陣列組欄位內容
	let json = {"type":"checkbox","id":"success"};
	let success_Item = setElement(input,json);
	success_Item.addEventListener('click',successItem);
	
	let item_text = document.createTextNode(item);
	
	json = {"src":"./assets/images/pencil.png","id":"update","class":"img-thumbnail"};
	let update_Item = setElement(img,json);
	update_Item.addEventListener('click',updateItem);
	
	//要在建立新的img元素，不然會被覆蓋
	img = document.createElement("img");
	json = {"src":"./assets/images/delete.png","id":"delete","class":"img-thumbnail"};
	let delete_Item = setElement(img,json);
	delete_Item.addEventListener('click',deleteItem);
	
	let colums = [success_Item,item_text,update_Item,delete_Item];
	
	//迴圈跑陣列新增至table裡
	for(var i=0; i<colums.length; i++){
		let td = document.createElement("td");
		if(i==0){
			td.setAttribute("scope", "row");
		}else if(i==1){
			td.setAttribute("class", "text");
		}
		td.appendChild(colums[i]);
		tr.appendChild(td);
	}

	document.getElementById("item").value = "";
	setTableCookie(item_table);
	console.log(getCookie("item_table"));
}

function setElement(element,json){
	for(key in json){
		element.setAttribute(key,json[key]);
	}
	
	return element;
}

function updateItem(){
	//使用class 判斷是否為編輯模式(在文字的節點上新增)
	let item_td = this.closest('tr').cells[1];
	let textbox = item_td.className;
	
	if(textbox=='text'){
		item_td.innerHTML = '<input type="textbox" class="form-control" id="update" name="update" value="'+item_td.innerText+'"/>';
		item_td.setAttribute("class","edit")
	}else{
		let td_childNode = item_td.childNodes[0];
		item_td.innerHTML =  td_childNode.value;
		item_td.setAttribute("class","text");
	}
	
	setTableFieldTextStyle(this.closest('table').id,item_td)
}

function setTableFieldTextStyle(id,obj){
	if(id=='success_table'){
		obj.setAttribute("style","text-decoration:line-through");
	}else{
		obj.setAttribute("style","");
	}
}

function deleteItem(){
	let td = this.parentNode;
	let tr = td.parentNode;
	tr.parentNode.removeChild(tr);
}

function successItem(){
	let item_table = this.closest('table');
	let table_id = item_table.id;
	let tr = this.closest('tr');

	//設定success_table裡的td為文字變更style 刪除
	//在設定td有文字又帶指定的class時style帶空白
	//let table = document.getElementById(table_id);
	//let tr = this.closest('tr');
	//tr.setAttribute("id", "su_item"+(table.rows.length-1));
	//table.appendChild(tr);
	
	if(table_id=="item_table"){
		let success_table = document.getElementById("success_table");
		tr.setAttribute("id", "su_item"+(success_table.rows.length-1));
		
		let su_text = tr.cells[1];
		su_text.setAttribute("class", "text");
		success_table.appendChild(tr);
		setTableFieldTextStyle(success_table.id,tr)
	}else{
		let item_table = document.getElementById("item_table");
		tr.setAttribute("id", "item"+(item_table.rows.length-1));
		
		let su_text = tr.cells[1];
		su_text.setAttribute("class", "");
		item_table.appendChild(tr);
	}
	
	
}

function setTableCookie(obj){
	let table = obj;
	let length = table.rows.length;
	
	//從第二行開始setCookie
	for(let i=1; i<length; i++){
		let row = table.rows[i];
		setCookie(row.id,row.innerHTML);
	}
	setCookie(table.id,length-1);
}

function setCookie(name,value){
	let days = 30;
	let date = new Date();
	date.setTime(date.getTime()+(days*24*60*60*1000));
	document.cookie = name + "=" + escape(value) + ";expires=" + date.toGMTString();
}

function getCookie(name){
	var name = name + "=";
	var decodedCookie = decodeURIComponent(document.cookie);
	var ca = decodedCookie.split(';');
	for(var i = 0; i <ca.length; i++) {
		var c = ca[i];
			while (c.charAt(0) == ' ') {
			c = c.substring(1);
		}	
		if (c.indexOf(name) == 0) {
		return c.substring(name.length, c.length);
    }
  }
  return "";
	//let arr = document.cookie.match(new RegExp("(^| )" + name + "=([^;]*)(;|$)"));
	//if (arr != null)return unescape(arr[2]); return null;
}

function delCookie(name){
	let date = new Date();
	date.setTime(date.getTime()-1);
	let cval = getCookie(name);
	if (cval != null) document.cookie = name + "=" + cval + ";expires=" + date.toGMTString();
}
</script>
</html>